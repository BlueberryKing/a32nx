// Copyright (c) 2023-2024 FlyByWire Simulations
//
// SPDX-License-Identifier: GPL-3.0

import {
  AircraftConfig,
  EngineModelParameters,
  FlightModelParameters,
  FMSymbolsConfig,
  LnavConfig,
  VnavConfig,
  VnavDescentMode,
} from '@fmgc/flightplanning/AircraftConfigTypes';
import { FlapConf } from '@fmgc/guidance/vnav/common';

const lnavConfig: LnavConfig = {
  DEFAULT_MIN_PREDICTED_TAS: 160,
  TURN_RADIUS_FACTOR: 1.0,
  NUM_COMPUTED_TRANSITIONS_AFTER_ACTIVE: -1,
};

const vnavConfig: VnavConfig = {
  VNAV_DESCENT_MODE: VnavDescentMode.NORMAL,
  VNAV_EMIT_CDA_FLAP_PWP: false,
  DEBUG_PROFILE: false,
  DEBUG_GUIDANCE: false,
  ALLOW_DEBUG_PARAMETER_INJECTION: false,
  VNAV_USE_LATCHED_DESCENT_MODE: false,
  IDLE_N1_MARGIN: 3,
  MAXIMUM_FUEL_ESTIMATE: 250_000,
};

const flightModelParams: FlightModelParameters = {
  wingSpan: 262.467,
  wingArea: 9096,
  wingEffcyFactor: 0.7,
  requiredAccelRateKNS: 1.33,
  requiredAccelRateMS2: 0.684,
  gravityConstKNS: 19.0626,
  gravityConstMS2: 9.806665,
  machValues: [0, 0.5, 0.55, 0.6, 0.65, 0.7, 0.75, 0.8, 0.85, 0.9, 0.95, 1.0],
  dragCoefficientCorrections: [0, 0, 0, 0.0002, 0.0003, 0.0004, 0.0008, 0.0013, 0.002, 0.005, 0.016, 0.1],
  speedBrakeDrag: 0.0201,
  gearDrag: 0.00872,
  dragPolarCoefficients: {
    [FlapConf.CLEAN]: [0.025, -5.48e-3, -0.0192, 0.0582],
    [FlapConf.CONF_1]: [0.0398, -0.0538, 0.1166, -0.064, 0.0303],
    [FlapConf.CONF_2]: [0.0729, -0.0037, -0.0018, 0.0168],
    [FlapConf.CONF_3]: [0.0902, 0.0005, -0.0056, 0.013],
    [FlapConf.CONF_FULL]: [0.1405, -0.001, -0.0056, 0.0077],
  },
};

const engineModelParams: EngineModelParameters = {
  maxThrust: 80_213,
  numberOfEngines: 4,
  fuelBurnFactor: 1.33,
  /**
   * Maximum N1 in CLB thrust
   * @param i row index (tat) in steps of 4Â°C
   * @param j col index (pressure altitude, ft)
   * @returns Corrected N1 (CN1)
   */
  n1ClimbLimit: [
    [0, 2000, 5000, 8000, 12000, 15000, 17000, 20000, 24000, 27000, 31000, 35000, 39000, 41500],
    [-54.0, 71.8, 73.6, 75.5, 76.8, 78.1, 78.9, 80.1, 81.5, 81.6, 83.0, 83.6, 83.7, 83.3],
    [-50.0, 72.5, 74.3, 76.2, 77.5, 78.8, 79.6, 80.9, 82.2, 82.4, 83.8, 84.4, 84.5, 84.0],
    [-46.0, 73.1, 75.0, 76.9, 78.2, 79.5, 80.3, 81.6, 83.0, 83.1, 84.5, 85.1, 85.3, 84.8],
    [-42.0, 73.8, 75.6, 77.6, 78.9, 80.2, 81.0, 82.3, 83.7, 83.8, 85.3, 85.9, 86.0, 85.5],
    [-38.0, 74.4, 76.3, 78.2, 79.6, 80.9, 81.7, 83.0, 84.4, 84.6, 86.0, 86.6, 86.7, 86.3],
    [-34.0, 75.0, 76.9, 78.9, 80.3, 81.6, 82.4, 83.7, 85.1, 85.3, 86.7, 87.3, 87.5, 87.0],
    [-30.0, 75.7, 77.6, 79.6, 80.9, 82.2, 83.1, 84.4, 85.8, 86.0, 87.5, 88.1, 88.2, 87.7],
    [-26.0, 76.3, 78.2, 80.2, 81.6, 82.9, 83.8, 85.1, 86.5, 86.7, 88.2, 88.8, 88.9, 88.4],
    [-22.0, 76.9, 78.8, 80.9, 82.2, 83.6, 84.4, 85.8, 87.2, 87.4, 88.9, 89.5, 89.6, 89.1],
    [-18.0, 77.5, 79.5, 81.5, 82.9, 84.2, 85.1, 86.5, 87.9, 88.1, 89.6, 90.2, 90.0, 89.5],
    [-14.0, 78.1, 80.1, 82.1, 83.5, 84.9, 85.8, 87.1, 88.6, 88.8, 90.3, 90.0, 89.2, 88.7],
    [-10.0, 78.7, 80.7, 82.8, 84.2, 85.6, 86.4, 87.8, 89.3, 89.5, 91.0, 89.2, 88.4, 87.9],
    [-6.0, 79.3, 81.3, 83.4, 84.8, 86.2, 87.1, 88.5, 90.0, 90.1, 91.1, 88.5, 87.7, 87.1],
    [-2.0, 79.9, 81.9, 84.0, 85.5, 86.8, 87.7, 89.1, 90.6, 90.8, 90.2, 87.7, 86.9, 86.4],
    [2.0, 80.5, 82.5, 84.6, 86.1, 87.5, 88.4, 89.8, 91.3, 90.3, 89.5, 87.0, 86.2, 85.6],
    [6.0, 81.1, 83.1, 85.3, 86.7, 88.1, 89.0, 90.4, 90.5, 89.5, 88.8, 86.3, 85.5, 84.9],
    [10.0, 81.6, 83.7, 85.9, 87.3, 88.7, 89.7, 90.0, 89.6, 88.7, 88.1, 85.6, 84.8, 84.2],
    [14.0, 82.2, 84.3, 86.5, 87.9, 89.4, 89.3, 89.1, 88.7, 87.9, 87.5, 84.8, 83.9, 83.3],
    [18.0, 82.8, 84.9, 87.1, 88.5, 88.6, 88.4, 88.3, 87.9, 87.2, 86.8, 86.8, 86.8, 86.8],
    [22.0, 83.4, 85.5, 86.9, 88.0, 87.8, 87.7, 87.5, 87.2, 86.5, 86.1, 86.1, 86.1, 86.1],
    [26.0, 83.9, 85.7, 86.2, 87.2, 87.1, 87.0, 86.8, 86.5, 85.8, 85.4, 85.4, 85.4, 85.4],
    [30.0, 84.5, 84.9, 85.4, 86.5, 86.4, 86.3, 86.1, 85.8, 85.1, 85.1, 85.1, 85.1, 85.1],
    [34.0, 83.8, 84.2, 84.7, 85.8, 85.7, 85.6, 85.5, 85.1, 85.1, 85.1, 85.1, 85.1, 85.1],
    [38.0, 83.0, 83.4, 83.9, 85.1, 85.0, 84.9, 84.8, 84.8, 84.8, 84.8, 84.8, 84.8, 84.8],
    [42.0, 82.2, 82.6, 83.1, 84.4, 84.4, 84.3, 84.3, 84.3, 84.3, 84.3, 84.3, 84.3, 84.3],
    [46.0, 81.4, 81.8, 82.4, 83.7, 83.7, 83.7, 83.7, 83.7, 83.7, 83.7, 83.7, 83.7, 83.7],
    [50.0, 80.6, 81.1, 81.6, 83.0, 83.0, 83.0, 83.0, 83.0, 83.0, 83.0, 83.0, 83.0, 83.0],
    [54.0, 79.9, 80.4, 80.4, 80.4, 80.4, 80.4, 80.4, 80.4, 80.4, 80.4, 80.4, 80.4, 80.4],
    [58.0, 79.2, 79.2, 79.2, 79.2, 79.2, 79.2, 79.2, 79.2, 79.2, 79.2, 79.2, 79.2, 79.2],
  ],
  /**
   * Table 1502 - CN2 vs CN1 @ Mach 0, 0.2, 0.9
   * n2_to_n1_table
   * @param i row index (n2)
   * @param j 1 = Mach 0, 2 = Mach 0.2, 3 = Mach 0.9
   * @returns Corrected N1 (CN1)
   */
  table1502: [
    [0, 0, 0.2, 0.9],
    [18.2, 0.0, 0.0, 17.0],
    [22.0, 1.9, 1.9, 17.4],
    [26.0, 2.5, 2.5, 18.2],
    [57.0, 12.8, 12.8, 27.0],
    [68.2, 19.6, 19.6, 34.827774],
    [77.0, 26.0, 26.0, 40.839552],
    [83.0, 31.42024, 31.42024, 44.768766],
    [89.0, 40.972041, 40.972041, 50.09214],
    [92.8, 51.0, 51.0, 55.042],
    [97.0, 65.0, 65.0, 65.0],
    [100.0, 77.0, 77.0, 77.0],
    [104.0, 85.0, 85.0, 85.5],
    [116.5, 101.0, 101.0, 101.0],
  ],
  /**
   * Table 1503 - Turbine LoMach (0) CN2 vs. Throttle @ IAP Ratio 1.00000000, 1.20172257, 1.453783983, 2.175007333, 3.364755652, 4.47246108, 5.415178313
   * mach_0_corrected_commanded_ne_table
   * @param i row index (thrust lever position)
   * @param j IAP ratio
   * @returns Corrected N2 (CN2)
   */
  table1503: [
    [0, 1.0, 1.20172257, 1.453783983, 2.175007333, 3.364755652, 4.47246108, 5.415178313],
    [0.0, 68.2, 69.402657, 70.671269, 73.432244, 76.544349, 78.644882, 78.644882],
    [0.1, 76.0, 77.340205, 78.753906, 81.830654, 85.298688, 87.639458, 87.639458],
    [0.2, 83.0, 84.463645, 86.007556, 89.367688, 93.155146, 95.711513, 95.711513],
    [0.4, 92.8, 94.436461, 96.162664, 99.919535, 104.154188, 107.01239, 107.01239],
    [0.6, 98.0, 99.728159, 101.55109, 105.518475, 109.990414, 113.008774, 113.008774],
    [0.75, 101.5, 103.289879, 105.177914, 109.286991, 113.918643, 117.044802, 117.044802],
    [0.9, 103.0, 104.81633, 106.0, 110.90207, 115.60217, 118.774528, 118.774528],
    [1.0, 104.2, 106.037491, 107.97575, 112.194133, 116.948991, 120.158309, 120.158309],
  ],
  /**
   * Table 1504 - Turbine HiMach (0.9) CN2 vs. Throttle @ IAP Ratio 1.00000000, 1.20172257, 1.453783983, 2.175007333, 3.364755652, 4.47246108, 5.415178313
   * mach_hi_corrected_commanded_ne_table
   * @param i row index (thrust lever position)
   * @param j IAP ratio
   * @returns Corrected N2 (CN2)
   */
  table1504: [
    [0, 1.0, 1.20172257, 1.453783983, 2.175007333, 3.364755652, 4.47246108, 5.415178313],
    [0.0, 63.267593, 64.383271, 65.560133, 68.121427, 71.008456, 72.957073, 72.957073],
    [0.1, 70.503476, 71.746753, 73.058212, 75.912441, 79.129658, 81.301137, 81.301137],
    [0.2, 76.997217, 78.355007, 79.787258, 82.904376, 86.417916, 88.789399, 88.789399],
    [0.4, 86.088455, 87.606562, 89.207922, 92.693086, 96.621477, 99.272967, 99.272967],
    [0.6, 90.912377, 92.51555, 94.206642, 97.887095, 102.035612, 104.835676, 104.835676],
    [0.75, 94.159247, 95.819677, 97.571165, 101.383063, 105.679741, 108.579808, 108.579808],
    [0.9, 95.550763, 97.235732, 98.333795, 102.881334, 107.24151, 110.184435, 110.184435],
    [1.0, 104.2, 106.037491, 107.97575, 112.194133, 116.948991, 120.158309, 120.158309],
  ],
  /**
   * Table 1506 - Corrected net Thrust vs CN1 @ Mach 0 to 0.9 in 0.1 steps
   * n1_and_mach_on_thrust_table
   * @param i row index (CN1)
   * @param j mach
   * @returns Corrected net thrust (pounds of force)
   */
  table1506: [
    [0, 0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9],
    [0, 0.015, -0.15, 0, 0, 0, 0, 0, 0, 0, 0],
    [20, 0.1286, -0.008, 0.015, 0.0337152, -0.0207408, -0.0447408, -0.0684924, -0.2470092, -0.3784788, -0.5864604],
    [25, 0.155, 0.0236, 0.018, 0.0364848, -0.0115116, -0.0318852, -0.0503988, -0.1815936, -0.3194448, -0.5268336],
    [30.0, 0.16, 0.16, 0.02, 0.039, 0.018, -0.01, -0.02, -0.107, -0.195, -0.428],
    [35.0, 0.315, 0.151, 0.093, 0.055, 0.045, 0.013, -0.002, -0.083, -0.164, -0.394],
    [40.0, 0.396, 0.195, 0.149, 0.083, 0.078, 0.043, 0.03, -0.051, -0.121, -0.342],
    [45.0, 0.472, 0.3, 0.188, 0.135, 0.116, 0.09, 0.06, -0.012, -0.069, -0.275],
    [50.0, 0.543, 0.373, 0.254, 0.19, 0.159, 0.17, 0.095, 0.033, -0.01, -0.196],
    [55.0, 0.611, 0.448, 0.324, 0.231, 0.22, 0.22, 0.16, 0.085, 0.055, -0.107],
    [60.0, 0.714, 0.528, 0.402, 0.28, 0.265, 0.25, 0.245, 0.14, 0.124, -0.012],
    [65.0, 0.792, 0.615, 0.489, 0.35, 0.32, 0.3, 0.29, 0.25, 0.196, 0.087],
    [70.0, 0.88, 0.712, 0.586, 0.4, 0.36, 0.36, 0.35, 0.34, 0.267, 0.185],
    [75.0, 0.982, 0.821, 0.695, 0.45, 0.42, 0.4, 0.38, 0.41, 0.35, 0.281],
    [80.0, 1.092, 0.941, 0.811, 0.55, 0.47, 0.44, 0.44, 0.47, 0.45, 0.38],
    [85.0, 1.23, 1.07, 0.932, 0.65, 0.57, 0.48, 0.52, 0.53, 0.51, 0.44],
    [90.0, 1.388, 1.206, 1.049, 0.75, 0.68, 0.55, 0.6, 0.58, 0.57, 0.52],
    [95.0, 1.538, 1.34, 1.153, 0.875, 0.75, 0.6, 0.659, 0.65, 0.62, 0.57],
    [100.0, 1.63, 1.465, 1.229, 0.95, 0.8, 0.7, 0.72, 0.68, 0.67, 0.63],
    [105.0, 1.655, 1.488, 1.258, 1.03, 0.859, 0.8, 0.8, 0.73, 0.72, 0.69],
    [110.0, 1.671, 1.503, 1.283, 1.1, 0.935, 0.9, 0.9, 0.763, 0.74, 0.72],
  ],
};

const fmsSymbolConfig: FMSymbolsConfig = {
  publishDepartureIdent: true,
};

export const A380AircraftConfig: AircraftConfig = {
  lnavConfig,
  vnavConfig,
  engineModelParameters: engineModelParams,
  flightModelParameters: flightModelParams,
  fmSymbolConfig: fmsSymbolConfig,
};
